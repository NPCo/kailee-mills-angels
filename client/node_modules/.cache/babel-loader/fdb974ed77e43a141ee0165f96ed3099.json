{"ast":null,"code":"import _objectWithoutProperties from \"D:\\\\Code\\\\Projects\\\\NPCo\\\\kailee-mills-angels\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectWithoutProperties\";\nimport _toConsumableArray from \"D:\\\\Code\\\\Projects\\\\NPCo\\\\kailee-mills-angels\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"D:\\\\Code\\\\Projects\\\\NPCo\\\\kailee-mills-angels\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\Code\\\\Projects\\\\NPCo\\\\kailee-mills-angels\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\Code\\\\Projects\\\\NPCo\\\\kailee-mills-angels\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\Code\\\\Projects\\\\NPCo\\\\kailee-mills-angels\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\Code\\\\Projects\\\\NPCo\\\\kailee-mills-angels\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"D:\\\\Code\\\\Projects\\\\NPCo\\\\kailee-mills-angels\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"D:\\\\Code\\\\Projects\\\\NPCo\\\\kailee-mills-angels\\\\client\\\\src\\\\views\\\\EditableAngelGrid.js\";\nimport React, { Component } from 'react';\nimport uuid from 'uuid';\nimport AngelGrid from './AngelDisplay.js';\nimport AngelListItem from '../components/AngelListItem.js';\nimport AngelEditForm from '../components/AngelEditForm.js';\nvar COLOR_LIST = ['#d7f5e1', '#deeeee', '#f17079'];\n\nvar EditAngelGrid =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(EditAngelGrid, _Component);\n\n  function EditAngelGrid(props) {\n    var _this;\n\n    _classCallCheck(this, EditAngelGrid);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(EditAngelGrid).call(this, props));\n    _this.state = {\n      angels: [],\n      focusId: null,\n      isBusy: true\n    };\n    var angels = _this.props.angels;\n    if (typeof angels === 'function') angels().then(function (data) {\n      return _this.setState({\n        angels: data,\n        isBusy: false\n      });\n    }).catch(function (err) {\n      return console.error('Error getting angels -', err);\n    });else _this.state = Object.assign(_this.state, {\n      angels: angels,\n      isBusy: false\n    });\n    _this.focus = _this.focus.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.editAngel = _this.editAngel.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.newAngel = _this.newAngel.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.removeAngel = _this.removeAngel.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.authenticateThen = _this.authenticateThen.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(EditAngelGrid, [{\n    key: \"focus\",\n    value: function focus(_id) {\n      this.setState({\n        focusId: _id\n      });\n    }\n  }, {\n    key: \"editAngel\",\n    value: function editAngel(values) {\n      var _this$state = this.state,\n          angels = _this$state.angels,\n          focusId = _this$state.focusId;\n      var index = angels.findIndex(function (a) {\n        return a._id === focusId;\n      });\n      var prevAngel = angels[index];\n      var newAngel = Object.assign(prevAngel, values);\n      this.setState({\n        angels: [].concat(_toConsumableArray(angels.slice(0, index)), [newAngel], _toConsumableArray(angels.slice(index + 1)))\n      });\n    }\n  }, {\n    key: \"newAngel\",\n    value: function newAngel() {\n      var angels = this.state.angels;\n\n      var _id = uuid();\n\n      var color = COLOR_LIST[angels.length % COLOR_LIST.length];\n      var columns = Math.max.apply(Math, _toConsumableArray(angels.map(function (a) {\n        return +a.w + +a.x - 1;\n      })).concat([1]));\n      var rows = Math.max.apply(Math, _toConsumableArray(angels.map(function (a) {\n        return +a.h + +a.y - 1;\n      })).concat([1]));\n      var slots = Array(columns * rows || 1).fill(false);\n      angels.forEach(function (a) {\n        for (var _x = a.x - 1; _x < a.x + +a.w - 1; _x++) {\n          for (var _y = a.y - 1; _y < a.y + +a.h - 1; _y++) {\n            slots[_x * rows + _y] = true;\n          }\n        }\n      });\n      var firstOpen = slots.findIndex(function (occupied) {\n        return !occupied;\n      });\n      var x = firstOpen !== -1 ? Math.floor(firstOpen / rows) + 1 : columns > rows ? 1 : columns + 1;\n      var y = firstOpen !== -1 ? firstOpen % rows + 1 : columns > rows ? rows + 1 : 1;\n      this.setState({\n        angels: angels.concat({\n          _id: _id,\n          color: color,\n          x: x,\n          y: y,\n          w: 1,\n          h: 1\n        }),\n        focusId: _id\n      });\n    }\n  }, {\n    key: \"removeAngel\",\n    value: function removeAngel(_id) {\n      this.setState({\n        angels: this.state.angels.filter(function (a) {\n          return a._id !== _id;\n        }),\n        focusId: null\n      });\n    }\n  }, {\n    key: \"authenticateThen\",\n    value: function authenticateThen(action) {\n      return function () {\n        var _this2 = this;\n\n        var username = prompt('Database Username:', this.state.username || '');\n        var password = prompt('Database Password:', this.state.password || '');\n        this.setState({\n          username: username,\n          password: password,\n          isBusy: true\n        });\n        var body = JSON.stringify({\n          credentials: {\n            username: username,\n            password: password\n          },\n          angels: this.state.angels.map(function (_ref) {\n            var _id = _ref._id,\n                data = _objectWithoutProperties(_ref, [\"_id\"]);\n\n            return data;\n          })\n        });\n        console.log(body);\n        action(body).then(function (data) {\n          return data.json();\n        }).then(function (data) {\n          return console.log('successs', data);\n        }).then(function () {\n          return _this2.setState({\n            isBusy: false\n          });\n        }).catch(function (err) {\n          return console.log('error!', err);\n        });\n      }.bind(this);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state2 = this.state,\n          angels = _this$state2.angels,\n          focusId = _this$state2.focusId,\n          isBusy = _this$state2.isBusy;\n      var saveDraft = this.authenticateThen(this.props.saveDraft);\n      var publish = this.authenticateThen(this.props.publish);\n      return React.createElement(\"div\", {\n        className: \"workspace-layout\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"edit-live-demo\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141\n        },\n        __self: this\n      }, React.createElement(AngelGrid, {\n        width: 250,\n        height: 150,\n        angels: angels,\n        key: uuid(),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"angel-list\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"angel-list-item\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: function onClick() {\n          return _this3.newAngel();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }, \"New Angel\"), React.createElement(\"button\", {\n        onClick: saveDraft,\n        disabled: isBusy,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147\n        },\n        __self: this\n      }, \"Save Changes\"), React.createElement(\"button\", {\n        onClick: publish,\n        disabled: isBusy,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, \"Publish\")), angels.map(function (a) {\n        return React.createElement(AngelListItem, Object.assign({\n          key: a._id\n        }, a, {\n          onClick: function onClick() {\n            return _this3.focus(a._id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        }));\n      })), !!focusId ? React.createElement(AngelEditForm, Object.assign({\n        onValueChange: this.editAngel,\n        removeAngel: function removeAngel() {\n          return _this3.removeAngel(focusId);\n        }\n      }, angels.find(function (a) {\n        return a._id === focusId;\n      }), {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      })) : React.createElement(React.Fragment, null));\n    }\n  }]);\n\n  return EditAngelGrid;\n}(Component);\n\nexport { EditAngelGrid as default };","map":{"version":3,"sources":["D:\\Code\\Projects\\NPCo\\kailee-mills-angels\\client\\src\\views\\EditableAngelGrid.js"],"names":["React","Component","uuid","AngelGrid","AngelListItem","AngelEditForm","COLOR_LIST","EditAngelGrid","props","state","angels","focusId","isBusy","then","data","setState","catch","err","console","error","Object","assign","focus","bind","editAngel","newAngel","removeAngel","authenticateThen","_id","values","index","findIndex","a","prevAngel","slice","color","length","columns","Math","max","map","w","x","rows","h","y","slots","Array","fill","forEach","firstOpen","occupied","floor","concat","filter","action","username","prompt","password","body","JSON","stringify","credentials","log","json","saveDraft","publish","find"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport uuid from 'uuid'\r\nimport AngelGrid from './AngelDisplay.js'\r\nimport AngelListItem from '../components/AngelListItem.js'\r\nimport AngelEditForm from '../components/AngelEditForm.js'\r\n\r\nconst COLOR_LIST = [\r\n  '#d7f5e1',\r\n  '#deeeee',\r\n  '#f17079'\r\n]\r\n\r\nexport default class EditAngelGrid extends Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      angels: [],\r\n      focusId: null,\r\n      isBusy: true\r\n    }\r\n\r\n    const { angels } = this.props\r\n\r\n    if (typeof angels === 'function')\r\n      angels()\r\n        .then(data => this.setState({ angels: data, isBusy: false }))\r\n        .catch(err => console.error('Error getting angels -', err))\r\n    else\r\n      this.state = Object.assign(this.state, { angels, isBusy: false })\r\n\r\n    this.focus = this.focus.bind(this)\r\n    this.editAngel = this.editAngel.bind(this)\r\n    this.newAngel = this.newAngel.bind(this)\r\n    this.removeAngel = this.removeAngel.bind(this)\r\n    this.authenticateThen = this.authenticateThen.bind(this)\r\n  }\r\n\r\n  focus(_id) {\r\n    this.setState({\r\n      focusId: _id\r\n    })\r\n  }\r\n\r\n  editAngel(values) {\r\n\r\n    const { angels, focusId } = this.state\r\n\r\n    const index = angels.findIndex(a => a._id === focusId)\r\n    const prevAngel = angels[index]\r\n    const newAngel = Object.assign(prevAngel, values)\r\n\r\n    this.setState({\r\n      angels: [\r\n        ...angels.slice(0, index),\r\n        newAngel,\r\n        ...angels.slice(index + 1)\r\n      ]\r\n    })\r\n  }\r\n\r\n  newAngel() {\r\n    const { angels } = this.state\r\n    const _id = uuid()\r\n    const color = COLOR_LIST[angels.length % COLOR_LIST.length]\r\n    const columns = Math.max(...angels.map(a => +a.w + +a.x - 1), 1)\r\n    const rows = Math.max(...angels.map(a => +a.h + +a.y - 1), 1)\r\n    \r\n    const slots = Array(columns * rows || 1).fill(false)\r\n    \r\n    angels.forEach(a => {\r\n      for (let x = a.x - 1; x < a.x + +a.w - 1; x++)\r\n        for (let y = a.y - 1; y < a.y + +a.h - 1; y++)\r\n          slots[x * rows + y] = true\r\n    })\r\n\r\n    const firstOpen = slots.findIndex(occupied => !occupied)\r\n    const x = firstOpen !== -1 \r\n      ? (Math.floor(firstOpen / rows) + 1)\r\n      : (columns > rows)\r\n      ? 1\r\n      : columns + 1\r\n\r\n    const y = firstOpen !== -1 \r\n      ? (firstOpen % rows + 1)\r\n      : (columns > rows)\r\n      ? rows + 1\r\n      : 1\r\n    \r\n\r\n    this.setState({\r\n      angels: angels.concat({ _id, color, x, y, w: 1, h: 1 }),\r\n      focusId: _id\r\n    })\r\n  }\r\n\r\n  removeAngel(_id) {\r\n    this.setState({\r\n      angels: this.state.angels.filter(a => a._id !== _id),\r\n      focusId: null\r\n    })\r\n  }\r\n\r\n  authenticateThen(action) {\r\n    return (function() {\r\n\r\n      const username = prompt('Database Username:', this.state.username || '')\r\n      const password = prompt('Database Password:', this.state.password || '')\r\n\r\n      this.setState({\r\n        username,\r\n        password,\r\n        isBusy: true\r\n      })\r\n\r\n      const body = JSON.stringify({\r\n        credentials: { username, password },\r\n        angels: this.state.angels.map(({ _id, ...data }) => data)\r\n      })\r\n\r\n      console.log(body)\r\n\r\n      action(body)\r\n        .then(data => data.json())\r\n        .then(data => console.log('successs', data))\r\n        .then(() => this.setState({ isBusy: false }))\r\n        .catch(err => console.log('error!', err))\r\n    }).bind(this)\r\n  }\r\n\r\n  render() {\r\n\r\n    const { angels, focusId, isBusy } = this.state\r\n\r\n    const saveDraft = this.authenticateThen(this.props.saveDraft)\r\n    const publish = this.authenticateThen(this.props.publish)\r\n\r\n    return (\r\n      <div className=\"workspace-layout\">\r\n        <div className=\"edit-live-demo\">\r\n            <AngelGrid width={250} height={150} angels={angels} key={uuid()} />\r\n        </div>\r\n        <div className=\"angel-list\">\r\n          <div className=\"angel-list-item\">\r\n            <button onClick={() => this.newAngel()}>New Angel</button>\r\n            <button onClick={saveDraft} disabled={isBusy}>Save Changes</button>\r\n            <button onClick={publish} disabled={isBusy}>Publish</button>\r\n          </div>\r\n          { \r\n            angels.map(a =>\r\n              <AngelListItem key={a._id} {...a} onClick={() => this.focus(a._id)} />\r\n            )\r\n          }\r\n        </div>\r\n        { \r\n          !!focusId\r\n            ? <AngelEditForm \r\n              onValueChange={this.editAngel}\r\n              removeAngel={() => this.removeAngel(focusId)}\r\n              {...angels.find(a => a._id === focusId)} />\r\n            : <></>\r\n        }\r\n      </div>\r\n    )\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}